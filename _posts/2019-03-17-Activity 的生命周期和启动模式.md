---
layout:     post
title:      Activity 的生命周期和启动模式
subtitle:   未完待续……
date:       2019-03-17
author:     YZune
header-img: img/post-bg-coffee.jpeg
catalog: true
tags:
    - Android
---

# Activity 的生命周期和启动模式

## Activity 的生命周期

### 典型情况下

在正常情况下，Activity 会经历如下生命周期。

1. onCreate：表示 Activity 正在被创建。可做初始化工作，如 setContentView 去加载界面布局资源、初始化所需数据等。
2. onRestart：从不可见重新变为可见时调用。所谓不可见是指 onStop 被执行了。
3. onStart：此时 Activity 已经可见了，但是还没有出现在前台，无法和用户交互。即此时 Activity 还在后台。
4. onResume：此时 Activity 可交互了。
5. onPause：正在停止，可以做一些存储数据、停止动画等工作，但不能太耗时，否则会影响新 Activity 的显示。**onPause 必须先执行，新 Activity 的 onResume 才会执行。**
6. onStop：可以做一些稍微重量级的回收工作，同样不能太耗时。
7. onDestroy：做一些回收工作和最终的资源释放。

### 一些特殊情况

1. 切换到新的 Activity，如果 新 Activity 采用了透明主题，当前的 Activity 不会回调 onStop，因为它还可见，只是不可交互。
2. 当系统配置发生改变后，Activity 会被销毁，其 onPause、onStop、onDestroy 都会被调用，同时由于 Activity 是在异常情况下终止的，系统会调用 onSaveInstanceState 来保存当前的状态。这个方法的调用时机是在 onStop 之前，不过和 onPause 没有既定的时序关系。正常情况下系统不会回调这个方法。从时序上来说，onRestoreInstanceState 的调用时机在 onStart 之后。

> 委托思想：上层委托下层、父容器委托子元素去处理一件事情，这种思想在 Android 中有很多应用，比如 View 的绘制过程、事件分发等。


## Activity 的启动模式

### Activity 的 LaunchMode

任务栈是一种“先进后出”的栈结构，当栈中没有任何 Activity 的时候，系统就会回收这个任务栈。Activity 目前有四种启动模式：standard、singleTop、singleTask 和 singleInstance。

1. standard：标准模式，这也是系统的默认模式。每次启动一个 Activity 都会创建一个新的实例，不管这个实例是否已经存在。被创建的实例的生命周期符合典型情况下的生命周期。在这种模式下，谁启动了这个 Activity，那么这个 Activity 就运行在启动它的那个 Activity 所在的栈中。
2. singleTop：栈顶复用模式。在这种模式下，如果新 Activity 已经位于任务栈的栈顶，那么此 Activity 不会被重新创建，同时它的 onNewIntent 方法会被回调，通过此方法的参数我们可以取出当前请求的信息。此时它的 onCreate、onStart 不会被系统调用。

> 尝试使用 ApplicationContext 去启动 standard 模式的 Activity时会报错，因为非 Activity 类型的 Context 并没有所谓的任务栈。